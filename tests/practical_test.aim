# =============================================================================
# PRACTICAL PROGRAMMING TEST - Real-world style programs
# =============================================================================

# -----------------------------------------------------------------------------
# STATISTICS
# -----------------------------------------------------------------------------
def mean(arr):
    if len(arr) == 0:
        return 0
    end
    total = 0
    i = 0
    while i < len(arr):
        total += arr[i]
        i += 1
    end
    return total / len(arr)
end

def variance(arr):
    if len(arr) == 0:
        return 0
    end
    avg = mean(arr)
    sum_sq = 0
    i = 0
    while i < len(arr):
        diff = arr[i] - avg
        sum_sq += diff * diff
        i += 1
    end
    return sum_sq / len(arr)
end

# Integer square root for std dev approximation
def isqrt(n):
    if n < 2:
        return n
    end
    x = n
    y = (x + 1) / 2
    while y < x:
        x = y
        y = (x + n / x) / 2
    end
    return x
end

# -----------------------------------------------------------------------------
# DATA PROCESSING
# -----------------------------------------------------------------------------
def filter_greater_than(arr, threshold):
    result = []
    i = 0
    while i < len(arr):
        if arr[i] > threshold:
            result.append(arr[i])
        end
        i += 1
    end
    return result
end

def filter_even(arr):
    result = []
    i = 0
    while i < len(arr):
        if arr[i] % 2 == 0:
            result.append(arr[i])
        end
        i += 1
    end
    return result
end

def map_double(arr):
    result = []
    i = 0
    while i < len(arr):
        result.append(arr[i] * 2)
        i += 1
    end
    return result
end

def map_square(arr):
    result = []
    i = 0
    while i < len(arr):
        result.append(arr[i] * arr[i])
        i += 1
    end
    return result
end

def reduce_sum(arr):
    total = 0
    i = 0
    while i < len(arr):
        total += arr[i]
        i += 1
    end
    return total
end

def reduce_product(arr):
    if len(arr) == 0:
        return 0
    end
    prod = 1
    i = 0
    while i < len(arr):
        prod *= arr[i]
        i += 1
    end
    return prod
end

# -----------------------------------------------------------------------------
# MATRIX OPERATIONS (2D array as 1D + width)
# -----------------------------------------------------------------------------
def matrix_create(rows, cols):
    size = rows * cols
    m = []
    i = 0
    while i < size:
        m.append(0)
        i += 1
    end
    return m
end

def matrix_get(m, cols, row, col):
    return m[row * cols + col]
end

def matrix_set(m, cols, row, col, val):
    m[row * cols + col] = val
end

def matrix_print(m, rows, cols):
    r = 0
    while r < rows:
        line = "["
        c = 0
        while c < cols:
            if c > 0:
                line = line + ", "
            end
            val = matrix_get(m, cols, r, c)
            # Pad single digits
            if val < 10:
                line = line + " "
            end
            line = line + str(val)
            c += 1
        end
        line = line + "]"
        print(line)
        r += 1
    end
end

def matrix_add(a, b, rows, cols):
    result = matrix_create(rows, cols)
    r = 0
    while r < rows:
        c = 0
        while c < cols:
            val = matrix_get(a, cols, r, c) + matrix_get(b, cols, r, c)
            matrix_set(result, cols, r, c, val)
            c += 1
        end
        r += 1
    end
    return result
end

def matrix_multiply(a, b, rows_a, cols_a, cols_b):
    # Result is rows_a x cols_b
    result = matrix_create(rows_a, cols_b)
    r = 0
    while r < rows_a:
        c = 0
        while c < cols_b:
            sum = 0
            k = 0
            while k < cols_a:
                sum += matrix_get(a, cols_a, r, k) * matrix_get(b, cols_b, k, c)
                k += 1
            end
            matrix_set(result, cols_b, r, c, sum)
            c += 1
        end
        r += 1
    end
    return result
end

# -----------------------------------------------------------------------------
# STACK DATA STRUCTURE
# -----------------------------------------------------------------------------
def stack_create():
    return []
end

def stack_push(stack, val):
    stack.append(val)
end

def stack_pop(stack):
    if len(stack) == 0:
        return -1
    end
    val = stack[len(stack) - 1]
    # Can't actually pop, so we'll work around it
    # This is a limitation - we need a real pop()
    return val
end

def stack_peek(stack):
    if len(stack) == 0:
        return -1
    end
    return stack[len(stack) - 1]
end

def stack_is_empty(stack):
    if len(stack) == 0:
        return 1
    end
    return 0
end

# -----------------------------------------------------------------------------
# EXPRESSION EVALUATOR (Postfix/RPN)
# Simulated with integer operations
# -----------------------------------------------------------------------------
def eval_rpn(tokens):
    # tokens is a list of integers and operation codes
    # Operations: -1=ADD, -2=SUB, -3=MUL, -4=DIV
    stack = []
    
    i = 0
    while i < len(tokens):
        tok = tokens[i]
        
        if tok >= 0:
            # It's a number, push it
            stack.append(tok)
        else:
            # It's an operation
            b = stack[len(stack) - 1]
            # Simulate pop by rebuilding
            new_stack = []
            j = 0
            while j < len(stack) - 1:
                new_stack.append(stack[j])
                j += 1
            end
            stack = new_stack
            
            a = stack[len(stack) - 1]
            new_stack = []
            j = 0
            while j < len(stack) - 1:
                new_stack.append(stack[j])
                j += 1
            end
            stack = new_stack
            
            result = 0
            if tok == -1:
                result = a + b
            elif tok == -2:
                result = a - b
            elif tok == -3:
                result = a * b
            elif tok == -4:
                result = a / b
            end
            
            stack.append(result)
        end
        i += 1
    end
    
    return stack[0]
end

# -----------------------------------------------------------------------------
# HISTOGRAM
# -----------------------------------------------------------------------------
def print_histogram(data, max_width):
    # Find max value for scaling
    max_val = 0
    i = 0
    while i < len(data):
        if data[i] > max_val:
            max_val = data[i]
        end
        i += 1
    end
    
    if max_val == 0:
        max_val = 1
    end
    
    i = 0
    while i < len(data):
        val = data[i]
        bar_len = (val * max_width) / max_val
        
        # Create label
        label = str(i) + ": "
        if i < 10:
            label = " " + label
        end
        
        # Create bar
        bar = "#" * bar_len
        
        # Create value
        val_str = " (" + str(val) + ")"
        
        print(label + bar + val_str)
        i += 1
    end
end

# -----------------------------------------------------------------------------
# SIMPLE HASH TABLE (using lists)
# -----------------------------------------------------------------------------
def hash_code(key, size):
    # Simple hash for integers
    return key % size
end

def hashtable_create(size):
    # Each slot is a list of [key, value] pairs (as flat list: k1,v1,k2,v2,...)
    table = []
    i = 0
    while i < size:
        table.append(0)  # 0 means empty slot (will be replaced with list)
        i += 1
    end
    return table
end

# Note: Full hashtable would need more infrastructure
# Leaving as placeholder for now

# -----------------------------------------------------------------------------
# LIST UTILITIES
# -----------------------------------------------------------------------------
def list_to_string(arr):
    result = "["
    i = 0
    while i < len(arr):
        if i > 0:
            result = result + ", "
        end
        result = result + str(arr[i])
        i += 1
    end
    return result + "]"
end

def list_reverse(arr):
    result = []
    i = len(arr) - 1
    while i >= 0:
        result.append(arr[i])
        i -= 1
    end
    return result
end

def list_copy(arr):
    result = []
    i = 0
    while i < len(arr):
        result.append(arr[i])
        i += 1
    end
    return result
end

# -----------------------------------------------------------------------------
# MAIN TEST
# -----------------------------------------------------------------------------
def main():
    print("=" * 60)
    print("PRACTICAL PROGRAMMING TEST")
    print("=" * 60)
    print("")
    
    # --- Statistics ---
    print("--- STATISTICS ---")
    data = [10, 20, 30, 40, 50, 60, 70, 80, 90, 100]
    print("Data: " + list_to_string(data))
    print("Mean: " + str(mean(data)))
    print("Variance: " + str(variance(data)))
    print("StdDev (approx): " + str(isqrt(variance(data))))
    print("")
    
    # --- Data Processing ---
    print("--- DATA PROCESSING ---")
    nums = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]
    print("Original: " + list_to_string(nums))
    print("Filter > 5: " + list_to_string(filter_greater_than(nums, 5)))
    print("Filter even: " + list_to_string(filter_even(nums)))
    print("Map double: " + list_to_string(map_double(nums)))
    print("Map square: " + list_to_string(map_square(nums)))
    print("Reduce sum: " + str(reduce_sum(nums)))
    print("Reduce product (1-5): " + str(reduce_product([1, 2, 3, 4, 5])))
    print("")
    
    # --- Matrix Operations ---
    print("--- MATRIX OPERATIONS ---")
    
    # Create 3x3 matrices
    m1 = matrix_create(3, 3)
    m2 = matrix_create(3, 3)
    
    # Fill m1 with 1,2,3,4,5,6,7,8,9
    val = 1
    r = 0
    while r < 3:
        c = 0
        while c < 3:
            matrix_set(m1, 3, r, c, val)
            val += 1
            c += 1
        end
        r += 1
    end
    
    # Fill m2 with 9,8,7,6,5,4,3,2,1
    val = 9
    r = 0
    while r < 3:
        c = 0
        while c < 3:
            matrix_set(m2, 3, r, c, val)
            val -= 1
            c += 1
        end
        r += 1
    end
    
    print("Matrix A:")
    matrix_print(m1, 3, 3)
    print("")
    print("Matrix B:")
    matrix_print(m2, 3, 3)
    print("")
    
    m3 = matrix_add(m1, m2, 3, 3)
    print("A + B:")
    matrix_print(m3, 3, 3)
    print("")
    
    m4 = matrix_multiply(m1, m2, 3, 3, 3)
    print("A * B:")
    matrix_print(m4, 3, 3)
    print("")
    
    # --- RPN Calculator ---
    print("--- RPN CALCULATOR ---")
    # Evaluate: 3 4 + 2 * = (3+4)*2 = 14
    # Using: -1=ADD, -2=SUB, -3=MUL, -4=DIV
    expr1 = [3, 4, -1, 2, -3]  # (3+4)*2
    print("3 4 + 2 * = " + str(eval_rpn(expr1)))
    
    expr2 = [10, 5, -4, 3, -3]  # (10/5)*3
    print("10 5 / 3 * = " + str(eval_rpn(expr2)))
    
    expr3 = [2, 3, -3, 4, 5, -3, -1]  # 2*3 + 4*5 = 26
    print("2 3 * 4 5 * + = " + str(eval_rpn(expr3)))
    print("")
    
    # --- Histogram ---
    print("--- HISTOGRAM ---")
    scores = [15, 42, 38, 27, 51, 33, 19, 45]
    print("Data: " + list_to_string(scores))
    print("")
    print_histogram(scores, 40)
    print("")
    
    # --- List Utilities ---
    print("--- LIST UTILITIES ---")
    arr = [1, 2, 3, 4, 5]
    print("Original: " + list_to_string(arr))
    print("Reversed: " + list_to_string(list_reverse(arr)))
    print("Copy: " + list_to_string(list_copy(arr)))
    print("")
    
    print("=" * 60)
    print("ALL PRACTICAL TESTS COMPLETE!")
    print("=" * 60)
end