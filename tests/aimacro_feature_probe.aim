# =============================================================================
# AIMACRO FEATURE PROBE TEST
# Tests features at various stages: working, untested, and boundary
# Based on the status document
# =============================================================================

# -----------------------------------------------------------------------------
# VERIFIED WORKING: String operations
# -----------------------------------------------------------------------------

def test_string_concat():
    s1 = "Hello"
    s2 = "World"
    s3 = s1 + " " + s2
    return s3
end

def test_string_repeat():
    s = "*" * 20
    return s
end

def test_string_len():
    s = "AIMacro"
    return len(s)
end

def test_string_equality_detailed():
    a = "test"
    b = "test"
    c = "TEST"
    d = "te" + "st"
    
    results = []
    
    if a == b:
        results.append(1)
    else:
        results.append(0)
    end
    
    if a == c:
        results.append(1)
    else:
        results.append(0)
    end
    
    if a == d:
        results.append(1)
    else:
        results.append(0)
    end
    
    if a != c:
        results.append(1)
    else:
        results.append(0)
    end
    
    return results
end

def test_str_conversion():
    num = 42
    s = str(num)
    result = "Value is " + s
    return result
end

# -----------------------------------------------------------------------------
# STRING METHOD TESTS (Mapped but need verification)
# -----------------------------------------------------------------------------

def test_string_methods():
    s = "  Hello World  "
    
    stripped = s.strip()
    print("Original: '" + s + "'")
    print("Stripped: '" + stripped + "'")
    
    word = "MixedCase"
    print("Upper: " + word.upper())
    print("Lower: " + word.lower())
    
    text = "hello world"
    pos = text.find("world")
    print("find world: " + str(pos))
    
    if text.startswith("hello"):
        print("startswith hello: True")
    else:
        print("startswith hello: False")
    end
    
    if text.endswith("world"):
        print("endswith world: True")
    else:
        print("endswith world: False")
    end
    
    return 1
end

# -----------------------------------------------------------------------------
# NOT PRECEDENCE TEST
# This is documented as having an edge case issue
# -----------------------------------------------------------------------------

def test_not_precedence_cases():
    x = 50
    results = []
    
    if not (x > 100):
        results.append(1)
    else:
        results.append(0)
    end
    
    if not x > 100:
        results.append(1)
    else:
        results.append(0)
    end
    
    if not (not (x > 0)):
        results.append(1)
    else:
        results.append(0)
    end
    
    if (not x > 100) and x > 0:
        results.append(1)
    else:
        results.append(0)
    end
    
    if (not x > 100) or x > 100:
        results.append(1)
    else:
        results.append(0)
    end
    
    return results
end

# -----------------------------------------------------------------------------
# CONTROL FLOW COMPREHENSIVE
# -----------------------------------------------------------------------------

def test_break_all_contexts():
    results = []
    
    count = 0
    for i in range(10):
        if i == 3:
            break
        end
        count += 1
    end
    results.append(count)
    
    count = 0
    while 1 == 1:
        count += 1
        if count == 5:
            break
        end
    end
    results.append(count)
    
    outer_count = 0
    for i in range(5):
        for j in range(5):
            if j == 2:
                break
            end
        end
        outer_count += 1
    end
    results.append(outer_count)
    
    return results
end

def test_continue_all_contexts():
    results = []
    
    total = 0
    for i in range(10):
        if i % 2 == 0:
            continue
        end
        total += i
    end
    results.append(total)
    
    total = 0
    i = 0
    while i < 10:
        i += 1
        if i % 2 == 0:
            continue
        end
        total += i
    end
    results.append(total)
    
    return results
end

# -----------------------------------------------------------------------------
# FUNCTION FEATURES
# -----------------------------------------------------------------------------

def test_recursion_depth():
    result = count_down_recursive(50)
    return result
end

def count_down_recursive(n):
    if n <= 0:
        return 0
    end
    return 1 + count_down_recursive(n - 1)
end

def test_function_as_expression():
    a = get_ten() + get_ten()
    b = get_ten() * get_ten()
    c = get_ten() - get_ten()
    return a * 10000 + b * 100 + c
end

def get_ten():
    return 10
end

def test_nested_calls_deep():
    result = add_two(add_two(add_two(1, 2), add_two(3, 4)), add_two(add_two(5, 6), add_two(7, 8)))
    return result
end

def add_two(a, b):
    return a + b
end

# -----------------------------------------------------------------------------
# LIST OPERATIONS DEEP DIVE
# -----------------------------------------------------------------------------

def test_list_comprehensive():
    results = []
    
    arr = [10, 20, 30]
    results.append(len(arr))
    
    results.append(arr[0])
    results.append(arr[2])
    
    arr[1] = 200
    results.append(arr[1])
    
    arr.append(40)
    results.append(len(arr))
    results.append(arr[3])
    
    empty = []
    results.append(len(empty))
    empty.append(1)
    results.append(len(empty))
    
    return results
end

def test_list_as_param():
    arr = [1, 2, 3, 4, 5]
    
    s = list_sum(arr)
    
    list_double_first(arr)
    
    return s * 1000 + arr[0]
end

def list_sum(arr):
    total = 0
    for i in range(len(arr)):
        total += arr[i]
    end
    return total
end

def list_double_first(arr):
    arr[0] = arr[0] * 2
end

# -----------------------------------------------------------------------------
# ARITHMETIC PRECISION
# -----------------------------------------------------------------------------

def test_arithmetic_precision():
    results = []
    
    big = 1000000
    results.append(big + big)
    results.append(big * 2)
    
    r = 2 + 3 * 4 - 5
    results.append(r)
    
    r = (2 + 3) * (4 - 1)
    results.append(r)
    
    r = 2 ** 10
    results.append(r)
    
    r = 17 % 5
    results.append(r)
    
    r = 17 / 5
    results.append(r)
    
    return results
end

def test_negative_number_ops():
    results = []
    
    a = -10
    b = 3
    
    results.append(a + b)
    results.append(a - b)
    results.append(a * b)
    results.append(a / b)
    neg_a = -a
    results.append(neg_a)
    
    return results
end

# -----------------------------------------------------------------------------
# MAIN TEST RUNNER
# -----------------------------------------------------------------------------

def main():
    print("=" * 60)
    print("AIMACRO FEATURE PROBE TEST")
    print("=" * 60)
    print("")
    
    print("--- STRING OPERATIONS ---")
    print("concat: " + test_string_concat())
    print("repeat: " + test_string_repeat())
    print("len: " + str(test_string_len()))
    print("str(): " + test_str_conversion())
    
    eq_results = test_string_equality_detailed()
    print("String equality tests:")
    print("  same literal: " + str(eq_results[0]))
    print("  diff case: " + str(eq_results[1]))
    print("  dynamic: " + str(eq_results[2]))
    print("  inequality: " + str(eq_results[3]))
    print("")
    
    print("--- STRING METHODS ---")
    test_string_methods()
    print("")
    
    print("--- NOT PRECEDENCE ---")
    not_results = test_not_precedence_cases()
    print("With parens: " + str(not_results[0]))
    print("Without parens: " + str(not_results[1]))
    print("Double not: " + str(not_results[2]))
    print("not with and: " + str(not_results[3]))
    print("not with or: " + str(not_results[4]))
    print("All should be 1")
    print("")
    
    print("--- BREAK TESTS ---")
    break_results = test_break_all_contexts()
    print("break in for (expect 3): " + str(break_results[0]))
    print("break in while (expect 5): " + str(break_results[1]))
    print("break in nested (expect 5): " + str(break_results[2]))
    print("")
    
    print("--- CONTINUE TESTS ---")
    cont_results = test_continue_all_contexts()
    print("continue in for (expect 25): " + str(cont_results[0]))
    print("continue in while (expect 25): " + str(cont_results[1]))
    print("")
    
    print("--- FUNCTION TESTS ---")
    print("recursion_depth(50): " + str(test_recursion_depth()))
    print("function_as_expression: " + str(test_function_as_expression()))
    print("nested_calls_deep: " + str(test_nested_calls_deep()))
    print("")
    
    print("--- LIST TESTS ---")
    list_results = test_list_comprehensive()
    print("len after create: " + str(list_results[0]))
    print("arr[0]: " + str(list_results[1]))
    print("arr[2]: " + str(list_results[2]))
    print("after modify arr[1]: " + str(list_results[3]))
    print("len after append: " + str(list_results[4]))
    print("arr[3]: " + str(list_results[5]))
    print("empty len: " + str(list_results[6]))
    print("after append to empty: " + str(list_results[7]))
    print("")
    
    print("list_as_param: " + str(test_list_as_param()))
    print("Expected: 15002")
    print("")
    
    print("--- ARITHMETIC TESTS ---")
    arith_results = test_arithmetic_precision()
    print("big + big: " + str(arith_results[0]))
    print("big * 2: " + str(arith_results[1]))
    print("precedence (expect 9): " + str(arith_results[2]))
    print("parens (expect 15): " + str(arith_results[3]))
    print("2**10 (expect 1024): " + str(arith_results[4]))
    print("17%5 (expect 2): " + str(arith_results[5]))
    print("17/5 (expect 3): " + str(arith_results[6]))
    print("")
    
    neg_results = test_negative_number_ops()
    print("Negative ops:")
    print("-10 + 3: " + str(neg_results[0]))
    print("-10 - 3: " + str(neg_results[1]))
    print("-10 * 3: " + str(neg_results[2]))
    print("-10 / 3: " + str(neg_results[3]))
    print("-(-10): " + str(neg_results[4]))
    print("")
    
    print("=" * 60)
    print("FEATURE PROBE COMPLETE!")
    print("=" * 60)
end