# comprehensive_test.aim
# THE ULTIMATE STRESS TEST - Everything we've got
# If this passes, we're ready to try transpiling compiler code

# =============================================================================
# SECTION 1: RECURSIVE ALGORITHMS
# =============================================================================

def factorial(n):
    if n <= 1:
        return 1
    end
    return n * factorial(n - 1)
end

def fib(n):
    if n <= 0:
        return 0
    end
    if n == 1:
        return 1
    end
    return fib(n - 1) + fib(n - 2)
end

def ackermann(m, n):
    if m == 0:
        return n + 1
    end
    if n == 0:
        return ackermann(m - 1, 1)
    end
    return ackermann(m - 1, ackermann(m, n - 1))
end

def gcd(a, b):
    while b != 0:
        temp = b
        b = a % b
        a = temp
    end
    return a
end

def power(base, exp):
    if exp == 0:
        return 1
    end
    if exp % 2 == 0:
        half = power(base, exp / 2)
        return half * half
    end
    return base * power(base, exp - 1)
end

# =============================================================================
# SECTION 2: ARRAY/LIST OPERATIONS
# =============================================================================

def test_arrays():
    print("--- ARRAY TESTS ---")
    
    arr = [64, 34, 25, 12, 22, 11, 90, 42, 15, 77]
    
    # Sum
    total = 0
    for i in range(10):
        total += arr[i]
    end
    print("Sum:", total)
    
    # Find max
    max_val = arr[0]
    for i in range(1, 10):
        if arr[i] > max_val:
            max_val = arr[i]
        end
    end
    print("Max:", max_val)
    
    # Find min
    min_val = arr[0]
    for i in range(1, 10):
        if arr[i] < min_val:
            min_val = arr[i]
        end
    end
    print("Min:", min_val)
    
    # Linear search
    target = 42
    found = -1
    for i in range(10):
        if arr[i] == target:
            found = i
            break
        end
    end
    print("Index of 42:", found)
    
    # Bubble sort
    for i in range(9):
        for j in range(9 - i):
            if arr[j] > arr[j + 1]:
                temp = arr[j]
                arr[j] = arr[j + 1]
                arr[j + 1] = temp
            end
        end
    end
    print("After sort, first:", arr[0])
    print("After sort, last:", arr[9])
end

# =============================================================================
# SECTION 3: STRING OPERATIONS
# =============================================================================

def test_strings():
    print("--- STRING TESTS ---")
    
    # Repeat
    line = "=" * 30
    print(line)
    
    # Case conversion
    msg = "Hello World"
    print("Original:", msg)
    print("Upper:", msg.upper())
    print("Lower:", msg.lower())
    
    # Strip
    padded = "   trimmed   "
    print("Stripped:", padded.strip())
    
    # Find
    text = "the quick brown fox"
    pos = text.find("quick")
    print("Find quick:", pos)
    
    # StartsWith/EndsWith
    filename = "report.txt"
    if filename.endswith(".txt"):
        print("Is text file: YES")
    else:
        print("Is text file: NO")
    end
    
    # Replace
    original = "hello world"
    replaced = original.replace("world", "AILang")
    print("Replaced:", replaced)
    
    # Count
    banana = "banana"
    count = banana.count("a")
    print("Count of 'a' in banana:", count)
    
    print("=" * 30)
end

# =============================================================================
# SECTION 4: CONTROL FLOW TORTURE
# =============================================================================

def test_control_flow():
    print("--- CONTROL FLOW TESTS ---")
    
    # Nested if/elif/else
    for x in range(4):
        if x == 0:
            print("zero")
        elif x == 1:
            print("one")
        elif x == 2:
            print("two")
        else:
            print("three")
        end
    end
    
    # Break in nested loops
    print("Break test:")
    found_i = -1
    found_j = -1
    for i in range(5):
        for j in range(5):
            if i * j == 6:
                found_i = i
                found_j = j
                break
            end
        end
        if found_i >= 0:
            break
        end
    end
    print("Found i*j=6 at i=", found_i, "j=", found_j)
    
    # Continue
    print("Odd numbers 1-10:")
    for i in range(1, 11):
        if i % 2 == 0:
            continue
        end
        print(i)
    end
    
    # Complex boolean
    a = 5
    b = 10
    c = 15
    if (a < b and b < c) or c < 0:
        print("Complex condition: TRUE")
    else:
        print("Complex condition: FALSE")
    end
end

# =============================================================================
# SECTION 5: MATH FUNCTIONS
# =============================================================================

def is_prime(n):
    if n < 2:
        return 0
    end
    if n == 2:
        return 1
    end
    if n % 2 == 0:
        return 0
    end
    i = 3
    while i * i <= n:
        if n % i == 0:
            return 0
        end
        i += 2
    end
    return 1
end

def integer_sqrt(n):
    if n < 2:
        return n
    end
    x = n
    y = (x + 1) / 2
    while y < x:
        x = y
        y = (x + n / x) / 2
    end
    return x
end

def sum_digits(n):
    total = 0
    while n > 0:
        total += n % 10
        n = n / 10
    end
    return total
end

def reverse_number(n):
    rev = 0
    while n > 0:
        rev = rev * 10 + n % 10
        n = n / 10
    end
    return rev
end

def test_math():
    print("--- MATH TESTS ---")
    
    print("5! =", factorial(5))
    print("10! =", factorial(10))
    print("fib(10) =", fib(10))
    print("ack(3,2) =", ackermann(3, 2))
    print("gcd(48, 18) =", gcd(48, 18))
    print("2^10 =", power(2, 10))
    print("sqrt(144) =", integer_sqrt(144))
    print("sum_digits(12345) =", sum_digits(12345))
    print("reverse(12345) =", reverse_number(12345))
    
    # Primes
    print("Primes under 30:")
    for n in range(2, 30):
        if is_prime(n) == 1:
            print(n)
        end
    end
end

# =============================================================================
# SECTION 6: FUNCTION CALL PATTERNS
# =============================================================================

def add(a, b):
    return a + b
end

def multiply(a, b):
    return a * b
end

def apply_twice(x, op):
    # Can't pass functions yet, so use a flag
    if op == 1:
        return add(x, x)
    else:
        return multiply(x, x)
    end
end

def nested_calls_test():
    print("--- NESTED CALL TESTS ---")
    
    # Nested arithmetic
    result = add(multiply(2, 3), multiply(4, 5))
    print("2*3 + 4*5 =", result)
    
    # Deep nesting
    result = add(add(add(1, 2), add(3, 4)), add(add(5, 6), add(7, 8)))
    print("((1+2)+(3+4))+((5+6)+(7+8)) =", result)
    
    # Function result in condition
    if add(2, 3) > multiply(1, 4):
        print("2+3 > 1*4: TRUE")
    else:
        print("2+3 > 1*4: FALSE")
    end
    
    # Recursive in expression
    result = factorial(3) + factorial(4)
    print("3! + 4! =", result)
end

# =============================================================================
# SECTION 7: EDGE CASES
# =============================================================================

def test_edge_cases():
    print("--- EDGE CASE TESTS ---")
    
    # Zero and negative
    print("factorial(0) =", factorial(0))
    print("fib(0) =", fib(0))
    print("fib(1) =", fib(1))
    
    # Empty loop
    count = 0
    for i in range(0):
        count += 1
    end
    print("Empty range loop count:", count)
    
    # Single iteration
    count = 0
    for i in range(1):
        count += 1
    end
    print("Single iteration count:", count)
    
    # Large numbers
    big = 1000000
    print("Million:", big)
    print("Million * 2:", big * 2)
    
    # Augmented assignment chain
    x = 1
    x += 2
    x *= 3
    x -= 1
    print("1+2=3, 3*3=9, 9-1 =", x)
    
    # Comparison chains in conditions
    a = 5
    b = 10
    c = 15
    if a < b:
        if b < c:
            print("a < b < c: TRUE")
        end
    end
end

# =============================================================================
# SECTION 8: WHILE LOOP VARIATIONS
# =============================================================================

def test_while_variations():
    print("--- WHILE LOOP TESTS ---")
    
    # Count up
    i = 0
    while i < 5:
        print("Up:", i)
        i += 1
    end
    
    # Count down
    i = 5
    while i > 0:
        i -= 1
        print("Down:", i)
    end
    
    # While with multiple conditions
    x = 0
    y = 10
    while x < 5 and y > 5:
        print("x=", x, "y=", y)
        x += 1
        y -= 1
    end
    
    # Early exit pattern
    i = 0
    while i < 100:
        if i * i > 50:
            print("First square > 50:", i * i)
            break
        end
        i += 1
    end
end

# =============================================================================
# MAIN - RUN ALL TESTS
# =============================================================================

def main():
    print("=" * 60)
    print("COMPREHENSIVE AIMACRO TEST SUITE")
    print("=" * 60)
    
    test_math()
    print("")
    
    test_arrays()
    print("")
    
    test_strings()
    print("")
    
    test_control_flow()
    print("")
    
    nested_calls_test()
    print("")
    
    test_edge_cases()
    print("")
    
    test_while_variations()
    print("")
    
    print("=" * 60)
    print("ALL TESTS COMPLETE!")
    print("If you see this, the transpiler is ready for real code.")
    print("=" * 60)
end