# test_harness_v2.aim - Test Harness without global keyword
# Uses return values to track pass/fail counts

def assert_eq(actual, expected, test_name):
    if actual == expected:
        print("  PASS:", test_name)
        return 1
    else:
        print("  FAIL:", test_name)
        print("    Expected:", expected)
        print("    Actual:", actual)
        return 0
    end
end

def assert_true(condition, test_name):
    return assert_eq(condition, 1, test_name)
end

def assert_false(condition, test_name):
    return assert_eq(condition, 0, test_name)
end

def test_arithmetic():
    print("")
    print("=== Arithmetic Tests ===")
    passed = 0
    
    passed = passed + assert_eq(1 + 1, 2, "1 + 1 = 2")
    passed = passed + assert_eq(10 - 3, 7, "10 - 3 = 7")
    passed = passed + assert_eq(4 * 5, 20, "4 * 5 = 20")
    passed = passed + assert_eq(20 / 4, 5, "20 / 4 = 5")
    passed = passed + assert_eq(17 % 5, 2, "17 % 5 = 2")
    
    x = 10
    y = 3
    passed = passed + assert_eq(x + y, 13, "x + y = 13")
    
    print("Arithmetic passed:", passed, "/ 6")
    return passed
end

def test_comparisons():
    print("")
    print("=== Comparison Tests ===")
    passed = 0
    
    passed = passed + assert_true(5 > 3, "5 > 3")
    passed = passed + assert_true(3 < 5, "3 < 5")
    passed = passed + assert_true(5 >= 5, "5 >= 5")
    passed = passed + assert_true(5 <= 5, "5 <= 5")
    passed = passed + assert_true(5 == 5, "5 == 5")
    passed = passed + assert_true(5 != 3, "5 != 3")
    
    print("Comparisons passed:", passed, "/ 6")
    return passed
end

def test_control_flow():
    print("")
    print("=== Control Flow Tests ===")
    passed = 0
    
    result = 0
    if 1:
        result = 1
    end
    passed = passed + assert_eq(result, 1, "if true branch")
    
    result = 0
    if 0:
        result = 1
    else:
        result = 2
    end
    passed = passed + assert_eq(result, 2, "else branch")
    
    count = 0
    i = 0
    while i < 5:
        count = count + 1
        i = i + 1
    end
    passed = passed + assert_eq(count, 5, "while loop 5x")
    
    print("Control flow passed:", passed, "/ 3")
    return passed
end

def test_for_range():
    print("")
    print("=== For Loop Tests ===")
    passed = 0
    
    total = 0
    for i in range(5):
        total = total + 1
    end
    passed = passed + assert_eq(total, 5, "range(5)")
    
    total = 0
    for i in range(2, 6):
        total = total + i
    end
    passed = passed + assert_eq(total, 14, "range(2,6) sum")
    
    print("For loops passed:", passed, "/ 2")
    return passed
end

def helper_add(a, b):
    return a + b
end

def helper_factorial(n):
    if n <= 1:
        return 1
    end
    return n * helper_factorial(n - 1)
end

def test_functions():
    print("")
    print("=== Function Tests ===")
    passed = 0
    
    passed = passed + assert_eq(helper_add(3, 4), 7, "add(3,4)")
    passed = passed + assert_eq(helper_factorial(5), 120, "factorial(5)")
    
    print("Functions passed:", passed, "/ 2")
    return passed
end

def test_lists():
    print("")
    print("=== List Tests ===")
    passed = 0
    
    nums = [1, 2, 3, 4, 5]
    passed = passed + assert_eq(len(nums), 5, "len([1,2,3,4,5])")
    passed = passed + assert_eq(nums[0], 1, "nums[0]")
    passed = passed + assert_eq(nums[2], 3, "nums[2]")
    passed = passed + assert_eq(nums[-1], 5, "nums[-1]")
    
    nums[0] = 100
    passed = passed + assert_eq(nums[0], 100, "nums[0] = 100")
    
    items = [10, 20]
    items.append(30)
    passed = passed + assert_eq(len(items), 3, "append len")
    passed = passed + assert_eq(items[2], 30, "append value")
    
    last = items.pop()
    passed = passed + assert_eq(last, 30, "pop value")
    passed = passed + assert_eq(len(items), 2, "pop len")
    
    print("Lists passed:", passed, "/ 10")
    return passed
end

def test_types():
    print("")
    print("=== Type Tests ===")
    passed = 0
    
    passed = passed + assert_true(isinstance(42, int), "42 is int")
    passed = passed + assert_true(isinstance("hi", str), "str is str")
    passed = passed + assert_true(isinstance([1,2], list), "list is list")
    
    nums = [5, 2, 8]
    s = sorted(nums)
    passed = passed + assert_true(isinstance(s, list), "sorted is list")
    passed = passed + assert_eq(s[0], 2, "sorted[0]")
    
    r = reversed([1, 2, 3])
    passed = passed + assert_true(isinstance(r, list), "reversed is list")
    passed = passed + assert_eq(r[0], 3, "reversed[0]")
    
    print("Types passed:", passed, "/ 7")
    return passed
end

def main():
    print("")
    print("========================================")
    print("    AIMACRO TEST HARNESS v2")
    print("========================================")
    
    total_passed = 0
    total_tests = 0
    
    p = test_arithmetic()
    total_passed = total_passed + p
    total_tests = total_tests + 6
    
    p = test_comparisons()
    total_passed = total_passed + p
    total_tests = total_tests + 6
    
    p = test_control_flow()
    total_passed = total_passed + p
    total_tests = total_tests + 3
    
    p = test_for_range()
    total_passed = total_passed + p
    total_tests = total_tests + 2
    
    p = test_functions()
    total_passed = total_passed + p
    total_tests = total_tests + 2
    
    p = test_lists()
    total_passed = total_passed + p
    total_tests = total_tests + 10
    
    p = test_types()
    total_passed = total_passed + p
    total_tests = total_tests + 7
    
    print("")
    print("========================================")
    print("TOTAL:", total_passed, "/", total_tests)
    print("========================================")
    
    if total_passed == total_tests:
        print("ALL TESTS PASSED!")
    else:
        failed = total_tests - total_passed
        print("FAILED:", failed)
    end
end