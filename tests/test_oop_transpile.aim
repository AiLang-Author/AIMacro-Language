# test_oop_transpile.aim
# Test suite for OOP transpilation in AIMacro
# This file tests the Python class syntax that should transpile to Library.OOP calls

# =============================================================================
# TEST 1: Simple Class with Fields
# =============================================================================

class Point:
    def __init__(self, x, y):
        self.x = x
        self.y = y
    
    def get_x(self):
        return self.x
    
    def get_y(self):
        return self.y
    
    def magnitude_squared(self):
        return self.x * self.x + self.y * self.y

def test_point():
    print("=== TEST 1: Simple Point Class ===")
    
    p = Point(3, 4)
    
    print("p.x:")
    print(p.x)
    
    print("p.y:")
    print(p.y)
    
    print("p.get_x():")
    print(p.get_x())
    
    print("p.magnitude_squared():")
    print(p.magnitude_squared())
    
    print("TEST 1 PASSED")
    print("")
end

# =============================================================================
# TEST 2: Inheritance
# =============================================================================

class Animal:
    def __init__(self, name, age):
        self.name = name
        self.age = age
    
    def speak(self):
        return "..."
    
    def get_age(self):
        return self.age
    
    def birthday(self):
        self.age = self.age + 1
        return self.age
end

class Dog(Animal):
    def __init__(self, name, age, breed):
        self.name = name
        self.age = age
        self.breed = breed
    
    def speak(self):
        return "Woof!"
    
    def get_breed(self):
        return self.breed
end

class Cat(Animal):
    def speak(self):
        return "Meow!"
end

def test_inheritance():
    print("=== TEST 2: Inheritance ===")
    
    dog = Dog("Buddy", 3, "Labrador")
    cat = Cat("Whiskers", 5)
    
    print("dog.name:")
    print(dog.name)
    
    print("dog.speak():")
    print(dog.speak())
    
    print("dog.get_breed():")
    print(dog.get_breed())
    
    print("dog.get_age():")
    print(dog.get_age())
    
    print("cat.name:")
    print(cat.name)
    
    print("cat.speak():")
    print(cat.speak())
    
    print("cat.get_age():")
    print(cat.get_age())
    
    # Test birthday (inherited method that mutates state)
    print("dog.birthday():")
    print(dog.birthday())
    
    print("dog.get_age() after birthday:")
    print(dog.get_age())
    
    print("TEST 2 PASSED")
    print("")
end

# =============================================================================
# TEST 3: isinstance()
# =============================================================================

def test_isinstance():
    print("=== TEST 3: isinstance() ===")
    
    dog = Dog("Rex", 2, "German Shepherd")
    cat = Cat("Mittens", 4)
    
    # Dog isinstance checks
    if isinstance(dog, Dog):
        print("isinstance(dog, Dog): PASS")
    else:
        print("isinstance(dog, Dog): FAIL")
    end
    
    if isinstance(dog, Animal):
        print("isinstance(dog, Animal): PASS")
    else:
        print("isinstance(dog, Animal): FAIL")
    end
    
    if isinstance(dog, Cat):
        print("isinstance(dog, Cat): FAIL (should not be Cat)")
    else:
        print("isinstance(dog, Cat): PASS (correctly not Cat)")
    end
    
    # Cat isinstance checks
    if isinstance(cat, Cat):
        print("isinstance(cat, Cat): PASS")
    else:
        print("isinstance(cat, Cat): FAIL")
    end
    
    if isinstance(cat, Animal):
        print("isinstance(cat, Animal): PASS")
    else:
        print("isinstance(cat, Animal): FAIL")
    end
    
    print("TEST 3 PASSED")
    print("")
end

# =============================================================================
# TEST 4: Counter (Stateful Object)
# =============================================================================

class Counter:
    def __init__(self, start):
        self.count = start
    
    def increment(self):
        self.count = self.count + 1
        return self.count
    
    def decrement(self):
        self.count = self.count - 1
        return self.count
    
    def get(self):
        return self.count
    
    def reset(self):
        self.count = 0
        return self.count
end

def test_counter():
    print("=== TEST 4: Counter (Stateful) ===")
    
    c = Counter(10)
    
    print("Initial count:")
    print(c.get())
    
    print("After increment:")
    print(c.increment())
    
    print("After increment:")
    print(c.increment())
    
    print("After increment:")
    print(c.increment())
    
    print("After decrement:")
    print(c.decrement())
    
    print("Current count:")
    print(c.get())
    
    print("After reset:")
    print(c.reset())
    
    print("TEST 4 PASSED")
    print("")
end

# =============================================================================
# TEST 5: Multiple Objects
# =============================================================================

def test_multiple_objects():
    print("=== TEST 5: Multiple Objects ===")
    
    p1 = Point(1, 2)
    p2 = Point(3, 4)
    p3 = Point(5, 6)
    
    print("p1.x:")
    print(p1.x)
    
    print("p2.x:")
    print(p2.x)
    
    print("p3.x:")
    print(p3.x)
    
    # Modify one, check others unchanged
    p2.x = 100
    
    print("After p2.x = 100:")
    print("p1.x (should be 1):")
    print(p1.x)
    
    print("p2.x (should be 100):")
    print(p2.x)
    
    print("p3.x (should be 5):")
    print(p3.x)
    
    print("TEST 5 PASSED")
    print("")
end

# =============================================================================
# TEST 6: Empty Class
# =============================================================================

class Empty:
    pass
end

def test_empty_class():
    print("=== TEST 6: Empty Class ===")
    
    e = Empty()
    
    if isinstance(e, Empty):
        print("Empty class instance created: PASS")
    else:
        print("Empty class instance: FAIL")
    end
    
    print("TEST 6 PASSED")
    print("")
end

# =============================================================================
# TEST 7: Method with Multiple Parameters
# =============================================================================

class Calculator:
    def __init__(self, initial):
        self.value = initial
    
    def add(self, x):
        self.value = self.value + x
        return self.value
    
    def multiply(self, x):
        self.value = self.value * x
        return self.value
    
    def add_two(self, a, b):
        self.value = self.value + a + b
        return self.value
    
    def get(self):
        return self.value
end

def test_calculator():
    print("=== TEST 7: Calculator (Multi-param Methods) ===")
    
    calc = Calculator(10)
    
    print("Initial value:")
    print(calc.get())
    
    print("After add(5):")
    print(calc.add(5))
    
    print("After multiply(2):")
    print(calc.multiply(2))
    
    print("After add_two(3, 7):")
    print(calc.add_two(3, 7))
    
    print("TEST 7 PASSED")
    print("")
end

# =============================================================================
# TEST 8: Attribute Assignment Outside __init__
# =============================================================================

class Flexible:
    def __init__(self):
        self.x = 0
    
    def set_values(self, a, b):
        self.x = a
        self.y = b  # y not in __init__
        return self.x + self.y
end

def test_flexible():
    print("=== TEST 8: Dynamic Attributes ===")
    
    f = Flexible()
    
    print("Initial x:")
    print(f.x)
    
    print("After set_values(10, 20):")
    result = f.set_values(10, 20)
    print(result)
    
    print("f.x:")
    print(f.x)
    
    print("f.y:")
    print(f.y)
    
    print("TEST 8 PASSED")
    print("")
end

# =============================================================================
# MAIN - Run All Tests
# =============================================================================

def main():
    print("######################################")
    print("# OOP TRANSPILATION TEST SUITE      #")
    print("######################################")
    print("")
    
    test_point()
    test_inheritance()
    test_isinstance()
    test_counter()
    test_multiple_objects()
    test_empty_class()
    test_calculator()
    test_flexible()
    
    print("######################################")
    print("# ALL OOP TESTS COMPLETE            #")
    print("######################################")
end