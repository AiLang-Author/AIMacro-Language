# complex_test_2.aim
# Comprehensive AIMacro test - exercises all working features

# =============================================================================
# RECURSIVE ALGORITHMS
# =============================================================================

def factorial(n):
    if n <= 1:
        return 1
    end
    return n * factorial(n - 1)
end

def fib_recursive(n):
    if n <= 0:
        return 0
    end
    if n == 1:
        return 1
    end
    return fib_recursive(n - 1) + fib_recursive(n - 2)
end

def ackermann(m, n):
    # Classic recursion stress test
    if m == 0:
        return n + 1
    end
    if n == 0:
        return ackermann(m - 1, 1)
    end
    return ackermann(m - 1, ackermann(m, n - 1))
end

# =============================================================================
# ITERATIVE ALGORITHMS  
# =============================================================================

def fib_iterative(n):
    if n <= 0:
        return 0
    end
    if n == 1:
        return 1
    end
    a = 0
    b = 1
    i = 2
    while i <= n:
        temp = a + b
        a = b
        b = temp
        i += 1
    end
    return b
end

def is_prime(n):
    if n < 2:
        return 0
    end
    if n == 2:
        return 1
    end
    if n % 2 == 0:
        return 0
    end
    i = 3
    while i * i <= n:
        if n % i == 0:
            return 0
        end
        i += 2
    end
    return 1
end

def count_primes(limit):
    count = 0
    n = 2
    while n <= limit:
        if is_prime(n) == 1:
            count += 1
        end
        n += 1
    end
    return count
end

def gcd(a, b):
    while b != 0:
        temp = b
        b = a % b
        a = temp
    end
    return a
end

def lcm(a, b):
    return (a * b) / gcd(a, b)
end

# =============================================================================
# ARRAY ALGORITHMS
# =============================================================================

def create_test_array():
    arr = [64, 34, 25, 12, 22, 11, 90, 42, 15, 77]
    return arr
end

def array_sum(arr, size):
    total = 0
    i = 0
    while i < size:
        total += arr[i]
        i += 1
    end
    return total
end

def array_max(arr, size):
    if size == 0:
        return 0
    end
    max_val = arr[0]
    i = 1
    while i < size:
        if arr[i] > max_val:
            max_val = arr[i]
        end
        i += 1
    end
    return max_val
end

def array_min(arr, size):
    if size == 0:
        return 0
    end
    min_val = arr[0]
    i = 1
    while i < size:
        if arr[i] < min_val:
            min_val = arr[i]
        end
        i += 1
    end
    return min_val
end

def linear_search(arr, size, target):
    i = 0
    while i < size:
        if arr[i] == target:
            return i
        end
        i += 1
    end
    return -1
end

def bubble_sort(arr, size):
    i = 0
    while i < size - 1:
        j = 0
        while j < size - i - 1:
            if arr[j] > arr[j + 1]:
                temp = arr[j]
                arr[j] = arr[j + 1]
                arr[j + 1] = temp
            end
            j += 1
        end
        i += 1
    end
end

def selection_sort(arr, size):
    i = 0
    while i < size - 1:
        min_idx = i
        j = i + 1
        while j < size:
            if arr[j] < arr[min_idx]:
                min_idx = j
            end
            j += 1
        end
        if min_idx != i:
            temp = arr[i]
            arr[i] = arr[min_idx]
            arr[min_idx] = temp
        end
        i += 1
    end
end

def insertion_sort(arr, size):
    i = 1
    while i < size:
        key = arr[i]
        j = i - 1
        while j >= 0 and arr[j] > key:
            arr[j + 1] = arr[j]
            j -= 1
        end
        arr[j + 1] = key
        i += 1
    end
end

def binary_search(arr, size, target):
    low = 0
    high = size - 1
    while low <= high:
        mid = (low + high) / 2
        if arr[mid] == target:
            return mid
        end
        if arr[mid] < target:
            low = mid + 1
        else:
            high = mid - 1
        end
    end
    return -1
end

def reverse_array(arr, size):
    left = 0
    right = size - 1
    while left < right:
        temp = arr[left]
        arr[left] = arr[right]
        arr[right] = temp
        left += 1
        right -= 1
    end
end

# =============================================================================
# MATH FUNCTIONS
# =============================================================================

def power(base, exp):
    if exp == 0:
        return 1
    end
    if exp % 2 == 0:
        half = power(base, exp / 2)
        return half * half
    end
    return base * power(base, exp - 1)
end

def integer_sqrt(n):
    if n < 2:
        return n
    end
    x = n
    y = (x + 1) / 2
    while y < x:
        x = y
        y = (x + n / x) / 2
    end
    return x
end

def is_perfect_square(n):
    root = integer_sqrt(n)
    return root * root == n
end

def sum_digits(n):
    total = 0
    while n > 0:
        total += n % 10
        n = n / 10
    end
    return total
end

def reverse_number(n):
    reversed = 0
    while n > 0:
        reversed = reversed * 10 + n % 10
        n = n / 10
    end
    return reversed
end

def is_palindrome_number(n):
    return n == reverse_number(n)
end

def count_digits(n):
    if n == 0:
        return 1
    end
    count = 0
    while n > 0:
        count += 1
        n = n / 10
    end
    return count
end

# =============================================================================
# MAIN TEST RUNNER
# =============================================================================

def main():
    print("=" * 50)
    print("AIMacro Comprehensive Test Suite")
    print("=" * 50)
    
    # Factorial tests
    print("Factorial Tests:")
    print("5! =", factorial(5))
    print("10! =", factorial(10))
    
    # Fibonacci tests
    print("Fibonacci Tests:")
    print("fib(10) recursive =", fib_recursive(10))
    print("fib(10) iterative =", fib_iterative(10))
    print("fib(20) iterative =", fib_iterative(20))
    
    # Ackermann (small values only!)
    print("Ackermann Tests:")
    print("ack(2,3) =", ackermann(2, 3))
    print("ack(3,2) =", ackermann(3, 2))
    
    # Prime tests
    print("Prime Tests:")
    print("Primes up to 50:")
    n = 2
    while n <= 50:
        if is_prime(n) == 1:
            print(n)
        end
        n += 1
    end
    print("Count of primes <= 100:", count_primes(100))
    
    # GCD/LCM
    print("GCD/LCM Tests:")
    print("gcd(48, 18) =", gcd(48, 18))
    print("gcd(100, 35) =", gcd(100, 35))
    print("lcm(12, 18) =", lcm(12, 18))
    
    # Array tests
    print("Array Tests:")
    arr = create_test_array()
    size = 10
    
    print("Original array stats:")
    print("Sum =", array_sum(arr, size))
    print("Max =", array_max(arr, size))
    print("Min =", array_min(arr, size))
    
    print("Linear search for 42:", linear_search(arr, size, 42))
    print("Linear search for 99:", linear_search(arr, size, 99))
    
    # Sorting
    bubble_sort(arr, size)
    print("After bubble sort:")
    print("First element:", arr[0])
    print("Last element:", arr[9])
    
    # Binary search on sorted array
    print("Binary search for 42:", binary_search(arr, size, 42))
    print("Binary search for 25:", binary_search(arr, size, 25))
    
    # Reverse
    reverse_array(arr, size)
    print("After reverse:")
    print("First element:", arr[0])
    print("Last element:", arr[9])
    
    # Math tests
    print("Math Tests:")
    print("2^10 =", power(2, 10))
    print("3^5 =", power(3, 5))
    print("sqrt(144) =", integer_sqrt(144))
    print("sqrt(1000) =", integer_sqrt(1000))
    print("is_perfect_square(144) =", is_perfect_square(144))
    print("is_perfect_square(145) =", is_perfect_square(145))
    print("sum_digits(12345) =", sum_digits(12345))
    print("reverse(12345) =", reverse_number(12345))
    print("is_palindrome(12321) =", is_palindrome_number(12321))
    print("is_palindrome(12345) =", is_palindrome_number(12345))
    print("count_digits(123456789) =", count_digits(123456789))
    
    print("=" * 50)
    print("All tests complete!")
    print("=" * 50)
end