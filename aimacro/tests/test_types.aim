# test_types.aim - Type System Integration Test
# Tests isinstance(), type(), and typed list operations

def test_isinstance_list():
    print("=== isinstance(x, list) tests ===")
    
    # List literal should be TArray (type-trackable)
    nums = [1, 2, 3, 4, 5]
    
    # This should return True (1) if TArray integration works
    result = isinstance(nums, list)
    print("isinstance([1,2,3,4,5], list):", result)
    
    if result == 1:
        print("PASS: List detected correctly")
    else:
        print("FAIL: List not detected")
    end
    
    # Test with integer
    x = 42
    result2 = isinstance(x, int)
    print("isinstance(42, int):", result2)
    
    # Test with string
    s = "hello"
    result3 = isinstance(s, str)
    print("isinstance('hello', str):", result3)
    
    return result
end

def test_sorted_returns_list():
    print("\n=== sorted() type test ===")
    
    original = [5, 2, 8, 1, 9]
    sorted_list = sorted(original)
    
    # The sorted result should also be a TArray
    result = isinstance(sorted_list, list)
    print("isinstance(sorted([...]), list):", result)
    
    if result == 1:
        print("PASS: sorted() returns typed list")
    else:
        print("FAIL: sorted() result not recognized as list")
    end
    
    # Verify sorting worked
    print("Sorted:", sorted_list[0], sorted_list[1], sorted_list[2])
    
    return result
end

def test_list_operations():
    print("\n=== List operations on TArray ===")
    
    items = [10, 20, 30]
    
    # Test len
    l = len(items)
    print("len([10,20,30]):", l)
    
    # Test append
    items.append(40)
    print("After append(40), len:", len(items))
    
    # Test indexing
    val = items[2]
    print("items[2]:", val)
    
    # Test negative indexing
    last = items[-1]
    print("items[-1]:", last)
    
    # Test index assignment
    items[0] = 100
    print("After items[0]=100:", items[0])
    
    # Test pop
    popped = items.pop()
    print("pop():", popped, "new len:", len(items))
    
    return 1
end

def test_reversed_type():
    print("\n=== reversed() type test ===")
    
    original = [1, 2, 3]
    rev = reversed(original)
    
    result = isinstance(rev, list)
    print("isinstance(reversed([...]), list):", result)
    
    if result == 1:
        print("PASS: reversed() returns typed list")
        print("Reversed:", rev[0], rev[1], rev[2])
    else:
        print("FAIL: reversed() result not recognized as list")
    end
    
    return result
end

def test_copy_type():
    print("\n=== copy() type test ===")
    
    original = [7, 8, 9]
    copied = original.copy()
    
    result = isinstance(copied, list)
    print("isinstance(copy(), list):", result)
    
    if result == 1:
        print("PASS: copy() returns typed list")
    else:
        print("FAIL: copy() result not recognized as list")
    end
    
    return result
end

def test_mixed_types():
    print("\n=== Mixed type tests ===")
    
    my_list = [1, 2, 3]
    my_str = "hello"
    my_int = 42
    
    # All three type checks
    is_list = isinstance(my_list, list)
    is_str = isinstance(my_str, str)
    is_int = isinstance(my_int, int)
    
    print("List check:", is_list)
    print("String check:", is_str)
    print("Integer check:", is_int)
    
    total = is_list + is_str + is_int
    if total == 3:
        print("PASS: All type checks correct")
    else:
        print("FAIL: Some type checks incorrect")
    end
    
    return total
end

def main():
    print("TYPE SYSTEM INTEGRATION TESTS")
    print("==============================\n")
    
    passed = 0
    total = 0
    
    # Test 1: isinstance with list
    total = total + 1
    if test_isinstance_list() == 1:
        passed = passed + 1
    end
    
    # Test 2: sorted returns list
    total = total + 1
    if test_sorted_returns_list() == 1:
        passed = passed + 1
    end
    
    # Test 3: list operations
    total = total + 1
    if test_list_operations() == 1:
        passed = passed + 1
    end
    
    # Test 4: reversed returns list
    total = total + 1
    if test_reversed_type() == 1:
        passed = passed + 1
    end
    
    # Test 5: copy returns list
    total = total + 1
    if test_copy_type() == 1:
        passed = passed + 1
    end
    
    # Test 6: mixed types
    total = total + 1
    if test_mixed_types() == 3:
        passed = passed + 1
    end
    
    print("\n==============================")
    print("RESULTS:", passed, "/", total, "tests passed")
    
    if passed == total:
        print("ALL TESTS PASSED!")
    else:
        print("SOME TESTS FAILED")
    end
end