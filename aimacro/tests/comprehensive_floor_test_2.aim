# =============================================================================
# AIMACRO FLOOR TEST 2 - EXTENDED FEATURES
# Tests features that are implemented but not in floor test 1
# Safe version - tests only known-safe syntax patterns
# =============================================================================

# -----------------------------------------------------------------------------
# HELPER FUNCTIONS
# -----------------------------------------------------------------------------

def assert_eq(actual, expected, name):
    if actual == expected:
        print("  PASS:", name)
        return 1
    else:
        print("  FAIL:", name)
        return 0
    end
end

def assert_true(value, name):
    return assert_eq(value, 1, name)
end

# =============================================================================
# SECTION 1: FOR X IN LIST
# =============================================================================

def test_for_in_list():
    print("")
    print("=== SECTION 1: For X In List ===")
    p = 0
    
    # Basic iteration
    nums = [10, 20, 30]
    total = 0
    for x in nums:
        total = total + x
    end
    p = p + assert_eq(total, 60, "for in list sum")
    
    # Iteration with append
    nums = [1, 2, 3, 4, 5]
    doubled = []
    for x in nums:
        doubled.append(x * 2)
    end
    p = p + assert_eq(len(doubled), 5, "for in list append len")
    p = p + assert_eq(doubled[0], 2, "doubled[0]")
    p = p + assert_eq(doubled[4], 10, "doubled[4]")
    
    # Nested for in list
    result = 0
    outer = [1, 2]
    inner = [10, 20]
    for a in outer:
        for b in inner:
            result = result + (a * b)
        end
    end
    p = p + assert_eq(result, 90, "nested for in list")
    
    print("For in list:", p, "/ 5")
    return p
end

# =============================================================================
# SECTION 2: STRING CONVERSION
# =============================================================================

def test_string_conversion():
    print("")
    print("=== SECTION 2: String Conversion ===")
    p = 0
    
    # int() on string
    x = int("123")
    p = p + assert_eq(x, 123, "int 123")
    
    x = int("0")
    p = p + assert_eq(x, 0, "int 0")
    
    x = int("999")
    p = p + assert_eq(x, 999, "int 999")
    
    # str() on integer
    s = str(42)
    p = p + assert_eq(len(s), 2, "str 42 len")
    p = p + assert_true(isinstance(s, str), "str 42 is str")
    
    s = str(0)
    p = p + assert_eq(len(s), 1, "str 0 len")
    
    s = str(12345)
    p = p + assert_eq(len(s), 5, "str 12345 len")
    
    print("String conversion:", p, "/ 7")
    return p
end

# =============================================================================
# SECTION 3: STRING CONCATENATION
# =============================================================================

def test_string_concat():
    print("")
    print("=== SECTION 3: String Concatenation ===")
    p = 0
    
    # Basic concat
    a = "hello"
    b = "world"
    c = a + b
    p = p + assert_eq(len(c), 10, "concat len")
    p = p + assert_true(isinstance(c, str), "concat is str")
    
    # Multiple concat
    c = a + " " + b
    p = p + assert_eq(len(c), 11, "concat space len")
    
    # Empty string concat
    c = "" + "test"
    p = p + assert_eq(len(c), 4, "empty plus str")
    
    c = "test" + ""
    p = p + assert_eq(len(c), 4, "str plus empty")
    
    print("String concat:", p, "/ 5")
    return p
end

# =============================================================================
# MAIN
# =============================================================================

def main():
    print("")
    print("============================================================")
    print("   AIMACRO FLOOR TEST 2 - EXTENDED FEATURES")
    print("============================================================")
    
    total = 0
    passed = 0
    
    p = test_for_in_list()
    passed = passed + p
    total = total + 5
    
    p = test_string_conversion()
    passed = passed + p
    total = total + 7
    
    p = test_string_concat()
    passed = passed + p
    total = total + 5
    
    print("")
    print("============================================================")
    print("                    FINAL RESULTS")
    print("============================================================")
    print("Total Tests:", total)
    print("Passed:", passed)
    failed = total - passed
    print("Failed:", failed)
    print("")
    
    if passed == total:
        print("*** ALL EXTENDED TESTS PASSED ***")
    else:
        pct = (passed * 100) / total
        print("Pass Rate:", pct, "%")
        print("*** SOME TESTS FAILED ***")
    end
    print("============================================================")
end