# test_aimacro_types.aim
# Test AIMacro code that exercises various language features
# This tests the compiler's code generation quality

def factorial(n):
    if n <= 1:
        return 1
    end
    return n * factorial(n - 1)
end

def fibonacci(n):
    if n <= 0:
        return 0
    end
    if n == 1:
        return 1
    end
    
    a = 0
    b = 1
    i = 2
    while i <= n:
        temp = a + b
        a = b
        b = temp
        i += 1
    end
    return b
end

def sum_list(items):
    total = 0
    for x in items:
        total += x
    end
    return total
end

def find_max(items):
    if len(items) == 0:
        return 0
    end
    
    max_val = items[0]
    for x in items:
        if x > max_val:
            max_val = x
        end
    end
    return max_val
end

def string_test():
    s = "Hello"
    s2 = " World"
    combined = s + s2
    print("Combined:", combined)
    print("Length:", len(combined))
    print("Upper:", combined.upper())
    
    # String indexing
    first = s[0]
    last = s[-1]
    print("First char:", first)
    print("Last char:", last)
end

def list_test():
    nums = [10, 20, 30, 40, 50]
    print("List:", nums)
    print("Length:", len(nums))
    print("Sum:", sum_list(nums))
    print("Max:", find_max(nums))
    
    # Append and modify
    nums.append(60)
    nums[0] = 100
    print("After modify:", nums)
    
    # Negative indexing
    last = nums[-1]
    print("Last element:", last)
end

def control_flow_test():
    # Test for loop with range
    print("Counting 0-4:")
    for i in range(5):
        print(i)
    end
    
    # Test while with break/continue
    print("Even numbers 0-8:")
    i = 0
    while i < 10:
        if i % 2 != 0:
            i += 1
            continue
        end
        if i > 8:
            break
        end
        print(i)
        i += 1
    end
end

def nested_calls_test():
    # Test nested function calls
    result = factorial(fibonacci(5))
    print("factorial(fibonacci(5)) =", result)
    
    # Complex expression
    nums = [3, 1, 4, 1, 5, 9, 2, 6]
    result2 = find_max(nums) + sum_list(nums)
    print("max + sum =", result2)
end

def main():
    print("=== AIMACRO LANGUAGE TEST ===")
    print("")
    
    print("[1] Factorial Test")
    print("5! =", factorial(5))
    print("")
    
    print("[2] Fibonacci Test")
    print("fib(10) =", fibonacci(10))
    print("")
    
    print("[3] String Test")
    string_test()
    print("")
    
    print("[4] List Test")
    list_test()
    print("")
    
    print("[5] Control Flow Test")
    control_flow_test()
    print("")
    
    print("[6] Nested Calls Test")
    nested_calls_test()
    print("")
    
    print("=== ALL TESTS COMPLETE ===")
end