# =============================================================================
# AIMACRO BUG ISOLATION TEST
# Targeted tests to isolate specific bugs found in edge case testing
# =============================================================================

# -----------------------------------------------------------------------------
# BUG 1: List index assignment not persisting?
# list_boundary_test returned 104 instead of 500
# -----------------------------------------------------------------------------

def test_list_assign_simple():
    print("=== BUG 1: List Index Assignment ===")
    
    arr = [0, 0, 0]
    print("Created arr = [0, 0, 0]")
    print("Initial arr[0]: " + str(arr[0]))
    print("Initial arr[1]: " + str(arr[1]))
    print("Initial arr[2]: " + str(arr[2]))
    
    arr[0] = 100
    print("After arr[0] = 100")
    print("arr[0]: " + str(arr[0]))
    
    arr[1] = 200
    print("After arr[1] = 200")
    print("arr[1]: " + str(arr[1]))
    
    arr[2] = 300
    print("After arr[2] = 300")
    print("arr[2]: " + str(arr[2]))
    
    total = arr[0] + arr[1] + arr[2]
    print("Sum (expect 600): " + str(total))
    print("")
end

def test_list_append_then_assign():
    print("=== List: Append then Assign ===")
    
    arr = []
    print("Created empty arr")
    
    arr.append(10)
    arr.append(20)
    arr.append(30)
    arr.append(40)
    arr.append(50)
    print("Appended 10,20,30,40,50")
    print("Length: " + str(len(arr)))
    
    print("Before modification:")
    print("arr[0]: " + str(arr[0]))
    print("arr[4]: " + str(arr[4]))
    
    arr[0] = 100
    arr[4] = 400
    
    print("After arr[0]=100, arr[4]=400:")
    print("arr[0]: " + str(arr[0]))
    print("arr[4]: " + str(arr[4]))
    
    total = arr[0] + arr[4]
    print("Sum (expect 500): " + str(total))
    print("")
end

def test_list_literal_then_assign():
    print("=== List: Literal then Assign ===")
    
    arr = [1, 2, 3, 4, 5]
    print("Created arr = [1,2,3,4,5]")
    
    print("Before modification:")
    print("arr[0]: " + str(arr[0]))
    print("arr[4]: " + str(arr[4]))
    
    arr[0] = 100
    arr[4] = 400
    
    print("After arr[0]=100, arr[4]=400:")
    print("arr[0]: " + str(arr[0]))
    print("arr[4]: " + str(arr[4]))
    
    total = arr[0] + arr[4]
    print("Sum (expect 500): " + str(total))
    print("")
end

# -----------------------------------------------------------------------------
# BUG 2: Many parameters issue
# many_params(1,2,3,4,5,6,7,8) returned 33 instead of 36
# -----------------------------------------------------------------------------

def test_param_count():
    print("=== BUG 2: Parameter Count ===")
    
    r1 = one_param(10)
    print("one_param(10): " + str(r1))
    
    r2 = two_params(10, 20)
    print("two_params(10,20): " + str(r2))
    
    r3 = three_params(10, 20, 30)
    print("three_params(10,20,30): " + str(r3))
    
    r4 = four_params(10, 20, 30, 40)
    print("four_params(10,20,30,40): " + str(r4))
    
    r5 = five_params(10, 20, 30, 40, 50)
    print("five_params(10,20,30,40,50): " + str(r5))
    
    r6 = six_params(10, 20, 30, 40, 50, 60)
    print("six_params(10,20,30,40,50,60): " + str(r6))
    
    r7 = seven_params(10, 20, 30, 40, 50, 60, 70)
    print("seven_params(10-70): " + str(r7))
    
    r8 = eight_params(10, 20, 30, 40, 50, 60, 70, 80)
    print("eight_params(10-80): " + str(r8))
    print("Expected: 360")
    print("")
end

def one_param(a):
    return a
end

def two_params(a, b):
    return a + b
end

def three_params(a, b, c):
    return a + b + c
end

def four_params(a, b, c, d):
    return a + b + c + d
end

def five_params(a, b, c, d, e):
    return a + b + c + d + e
end

def six_params(a, b, c, d, e, f):
    return a + b + c + d + e + f
end

def seven_params(a, b, c, d, e, f, g):
    return a + b + c + d + e + f + g
end

def eight_params(a, b, c, d, e, f, g, h):
    return a + b + c + d + e + f + g + h
end

def test_param_individual_values():
    print("=== Parameter Individual Values ===")
    print("Testing 8 params individually:")
    check_eight(1, 2, 3, 4, 5, 6, 7, 8)
    print("")
end

def check_eight(a, b, c, d, e, f, g, h):
    print("a = " + str(a) + " (expect 1)")
    print("b = " + str(b) + " (expect 2)")
    print("c = " + str(c) + " (expect 3)")
    print("d = " + str(d) + " (expect 4)")
    print("e = " + str(e) + " (expect 5)")
    print("f = " + str(f) + " (expect 6)")
    print("g = " + str(g) + " (expect 7)")
    print("h = " + str(h) + " (expect 8)")
    sum_val = a + b + c + d + e + f + g + h
    print("Sum = " + str(sum_val) + " (expect 36)")
end

# -----------------------------------------------------------------------------
# BUG 3: List mutation in function
# list_as_param returned 15004 instead of 15002
# -----------------------------------------------------------------------------

def test_list_mutation():
    print("=== BUG 3: List Mutation in Function ===")
    
    arr = [10, 20, 30]
    print("Created arr = [10, 20, 30]")
    print("arr[0] before: " + str(arr[0]))
    
    double_element(arr, 0)
    print("Called double_element(arr, 0)")
    print("arr[0] after: " + str(arr[0]))
    print("Expected: 20")
    print("")
    
    arr2 = [5, 10, 15]
    print("Created arr2 = [5, 10, 15]")
    sum_before = arr2[0] + arr2[1] + arr2[2]
    print("Sum before: " + str(sum_before))
    
    triple_first(arr2)
    print("Called triple_first(arr2)")
    sum_after = arr2[0] + arr2[1] + arr2[2]
    print("Sum after: " + str(sum_after))
    print("arr2[0]: " + str(arr2[0]))
    print("Expected arr2[0]: 15")
    print("")
end

def double_element(arr, idx):
    val = arr[idx]
    arr[idx] = val * 2
end

def triple_first(arr):
    arr[0] = arr[0] * 3
end

# -----------------------------------------------------------------------------
# BUG 4: String quoting issue
# strip() test showed malformed output
# -----------------------------------------------------------------------------

def test_string_quotes():
    print("=== BUG 4: String Quote Display ===")
    
    s1 = "hello"
    print("String: [" + s1 + "]")
    
    s2 = "  hello  "
    print("With spaces: [" + s2 + "]")
    
    s3 = s2.strip()
    print("After strip: [" + s3 + "]")
    
    print("Testing quote char in string:")
    s4 = "test"
    msg = "Value is: '" + s4 + "'"
    print(msg)
    print("")
end

# -----------------------------------------------------------------------------
# Additional: Test XArray operations directly
# -----------------------------------------------------------------------------

def test_list_operations_verbose():
    print("=== Verbose List Operations ===")
    
    arr = []
    print("Empty list created, len=" + str(len(arr)))
    
    i = 0
    while i < 5:
        arr.append(i * 10)
        print("Appended " + str(i * 10) + ", len now=" + str(len(arr)))
        i = i + 1
    end
    
    print("Reading all elements:")
    j = 0
    while j < 5:
        val = arr[j]
        print("arr[" + str(j) + "] = " + str(val))
        j = j + 1
    end
    
    print("Modifying elements:")
    arr[0] = 999
    arr[2] = 888
    arr[4] = 777
    
    print("After modifications:")
    k = 0
    while k < 5:
        val = arr[k]
        print("arr[" + str(k) + "] = " + str(val))
        k = k + 1
    end
    print("")
end

# -----------------------------------------------------------------------------
# MAIN
# -----------------------------------------------------------------------------

def main():
    print("=" * 60)
    print("AIMACRO BUG ISOLATION TEST")
    print("=" * 60)
    print("")
    
    test_list_assign_simple()
    test_list_append_then_assign()
    test_list_literal_then_assign()
    
    test_param_count()
    test_param_individual_values()
    
    test_list_mutation()
    
    test_string_quotes()
    
    test_list_operations_verbose()
    
    print("=" * 60)
    print("BUG ISOLATION COMPLETE")
    print("=" * 60)
end